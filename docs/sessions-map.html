<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sessions Map - Mobile GIS SIG</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <style>
        #map {
            height: 600px;
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        .map-controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #2c5282;
            background-color: white;
            color: #2c5282;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background-color: #2c5282;
            color: white;
        }

        .filter-btn.active {
            background-color: #2c5282;
            color: white;
        }

        .map-legend {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }

        .legend-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }

        .marker-upcoming {
            background-color: #48bb78;
        }

        .marker-past {
            background-color: #718096;
        }

        .session-popup h3 {
            margin: 0 0 5px 0;
            color: #2c5282;
        }

        .session-popup .session-type {
            display: inline-block;
            background-color: #e2e8f0;
            color: #2c5282;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 5px 0;
        }

        .session-popup .session-date {
            font-weight: 600;
            margin: 5px 0;
        }

        .session-popup .session-location {
            color: #666;
            margin: 5px 0;
        }

        .session-popup .session-description {
            margin: 10px 0;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            #map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="container">
                <h1 class="logo">Mobile GIS SIG</h1>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="projects.html">Projects</a></li>
                    <li><a href="sessions.html">Sessions</a></li>
                    <li><a href="sessions-map.html" class="active">Sessions Map</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="page-header">
            <div class="container">
                <h1>Sessions Map</h1>
                <p class="subtitle">Explore our workshops, technical sessions, and events across the globe</p>
            </div>
        </section>

        <section class="content">
            <div class="container">
                <div class="map-controls">
                    <button class="filter-btn active" data-filter="all">All Sessions</button>
                    <button class="filter-btn" data-filter="upcoming">Upcoming Only</button>
                    <button class="filter-btn" data-filter="past">Past Sessions</button>
                    <button class="filter-btn" data-filter="Workshop">Workshops</button>
                    <button class="filter-btn" data-filter="Technical Session">Technical Sessions</button>
                    <button class="filter-btn" data-filter="Discussion">Discussions</button>
                </div>

                <div id="map"></div>

                <div class="map-legend">
                    <h3>Legend</h3>
                    <div class="legend-item">
                        <div class="legend-marker marker-upcoming"></div>
                        <span>Upcoming Sessions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-marker marker-past"></div>
                        <span>Past Sessions</span>
                    </div>
                </div>

                <div class="content-block">
                    <h2>About the Sessions Map</h2>
                    <p>This interactive map displays all Mobile GIS SIG sessions, workshops, and events. Click on any marker to view detailed information about the session, including date, location, and topics covered. Use the filter buttons above to view specific types of sessions or filter by time period.</p>
                    <p>Our sessions are held at various archaeological institutions and conference venues around the world, fostering international collaboration and knowledge exchange in mobile GIS for archaeology.</p>
                </div>

                <div class="content-block cta-block">
                    <h2>Want to Host a Session?</h2>
                    <p>Interested in hosting a Mobile GIS SIG session or workshop at your institution? We're always looking for opportunities to engage with the archaeological community.</p>
                    <a href="contact.html" class="btn btn-primary">Contact Us</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Mobile GIS Special Interest Group - CAA. All rights reserved.</p>
            <p><a href="contact.html">Contact Us</a></p>
        </div>
    </footer>

    <script src="sessions-data.js"></script>
    <script>
        // Initialize the map centered on Europe
        const map = L.map('map').setView([48.8566, 2.3522], 4);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        // Store all markers for filtering
        let allMarkers = [];

        // Function to create marker icon based on session status
        function getMarkerIcon(status) {
            const color = status === 'upcoming' ? '#48bb78' : '#718096';
            return L.divIcon({
                className: 'custom-marker',
                html: `<div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50%; border: 3px solid #333;"></div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });
        }

        // Function to create popup content
        function createPopupContent(session) {
            let topicsHtml = '';
            if (session.topics && session.topics.length > 0) {
                topicsHtml = '<ul style="margin: 10px 0; padding-left: 20px;">';
                session.topics.forEach(topic => {
                    topicsHtml += `<li>${topic}</li>`;
                });
                topicsHtml += '</ul>';
            }

            return `
                <div class="session-popup">
                    <h3>${session.title}</h3>
                    <span class="session-type">${session.type}</span>
                    <p class="session-date"><strong>Date:</strong> ${new Date(session.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    <p class="session-location"><strong>Location:</strong> ${session.location}</p>
                    <p class="session-description">${session.description}</p>
                    ${topicsHtml}
                </div>
            `;
        }

        // Function to add sessions to map
        function addSessionsToMap(sessions) {
            sessions.forEach(session => {
                const marker = L.marker([session.lat, session.lng], {
                    icon: getMarkerIcon(session.status)
                }).addTo(map);

                marker.bindPopup(createPopupContent(session), {
                    maxWidth: 400
                });

                // Store marker with session data for filtering
                marker.sessionData = session;
                allMarkers.push(marker);
            });
        }

        // Add all sessions to map
        addSessionsToMap(sessionsData.upcoming);
        addSessionsToMap(sessionsData.past);

        // Fit map to show all markers
        if (allMarkers.length > 0) {
            const group = L.featureGroup(allMarkers);
            map.fitBounds(group.getBounds().pad(0.1));
        }

        // Filter functionality
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Update active button
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;

                // Show/hide markers based on filter
                allMarkers.forEach(marker => {
                    const session = marker.sessionData;
                    let show = true;

                    if (filter === 'upcoming') {
                        show = session.status === 'upcoming';
                    } else if (filter === 'past') {
                        show = session.status === 'past';
                    } else if (filter !== 'all') {
                        // Type filter
                        show = session.type === filter;
                    }

                    if (show) {
                        marker.addTo(map);
                    } else {
                        map.removeLayer(marker);
                    }
                });
            });
        });
    </script>
</body>
</html>
