<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sessions Map - Mobile GIS SIG</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <style>
        #map {
            height: 600px;
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        .map-controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #2c5282;
            background-color: white;
            color: #2c5282;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background-color: #2c5282;
            color: white;
        }

        .filter-btn.active {
            background-color: #2c5282;
            color: white;
        }

        .map-legend {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }

        .legend-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }

        .marker-upcoming {
            background-color: #48bb78;
        }

        .marker-past {
            background-color: #718096;
        }

        .session-popup h3 {
            margin: 0 0 5px 0;
            color: #2c5282;
            font-size: 1.1em;
        }

        .session-popup .session-type {
            display: inline-block;
            background-color: #e2e8f0;
            color: #2c5282;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 5px 0;
        }

        .session-popup .session-date {
            font-weight: 600;
            margin: 5px 0;
        }

        .session-popup .session-location {
            color: #666;
            margin: 5px 0;
        }

        .session-popup .session-description {
            margin: 10px 0;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
        }

        .session-popup .session-topics {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e2e8f0;
        }

        .session-popup .session-topics strong {
            color: #2c5282;
            display: block;
            margin-bottom: 5px;
        }

        .session-popup .session-topics ul {
            margin: 5px 0;
            padding-left: 20px;
        }

        .session-popup .session-topics li {
            margin: 3px 0;
            font-size: 0.9em;
        }

        .info-box {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            #map {
                height: 400px;
            }

            .map-controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="container">
                <h1 class="logo">Mobile GIS SIG</h1>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="projects.html">Projects</a></li>
                    <li><a href="sessions.html">Sessions</a></li>
                    <li><a href="sessions-map.html" class="active">Sessions Map</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="page-header">
            <div class="container">
                <h1>Sessions Map</h1>
                <p class="subtitle">Explore our scientific sessions and events across the globe</p>
            </div>
        </section>

        <section class="content">
            <div class="container">
                <div class="info-box">
                    <p>This interactive map displays all Mobile GIS SIG sessions organized at CAA conferences since 2017. Click on any marker to view detailed information about the session, including date, location, description, and topics covered. Use the filter buttons below to view specific types of sessions or filter by time period.</p>
                </div>

                <div class="map-controls">
                    <button class="filter-btn active" data-filter="all">All Sessions</button>
                    <button class="filter-btn" data-filter="upcoming">Upcoming Only</button>
                    <button class="filter-btn" data-filter="past">Past Sessions</button>
                    <button class="filter-btn" data-filter="Scientific Session">Scientific Sessions</button>
                </div>

                <div id="map"></div>

                <div class="map-legend">
                    <h3>Legend</h3>
                    <div class="legend-item">
                        <div class="legend-marker marker-upcoming"></div>
                        <span>Upcoming Sessions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-marker marker-past"></div>
                        <span>Past Sessions</span>
                    </div>
                </div>

                <div class="content-block">
                    <h2>About the Sessions Map</h2>
                    <p>Our sessions are held at various CAA conference venues around the world, fostering international collaboration and knowledge exchange in mobile GIS for archaeology. Since our first session in Atlanta (2017), we have organized sessions in major European cities and online, bringing together researchers from diverse archaeological contexts.</p>
                    <p>Each session focuses on different aspects of mobile GIS, from technical innovations and GNSS technologies to collaborative workflows, data standards, and community empowerment. The sessions have evolved from foundational discussions about mobile GIS possibilities to more specialized topics like measuring impact and addressing sustainability challenges.</p>
                </div>

                <div class="content-block cta-block">
                    <h2>Want to Host a Session?</h2>
                    <p>Interested in hosting a Mobile GIS SIG session or workshop at your institution? We're always looking for opportunities to engage with the archaeological community.</p>
                    <a href="contact.html" class="btn btn-primary">Contact Us</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Mobile GIS Special Interest Group - CAA. All rights reserved.</p>
            <p><a href="contact.html">Contact Us</a></p>
        </div>
    </footer>

    <script src="sessions-data.js"></script>
    <script>
        // Initialize the map centered on Europe
        const map = L.map('map').setView([48.8566, 2.3522], 4);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        // Store all markers for filtering
        let allMarkers = [];
        let markerCluster = L.layerGroup().addTo(map);

        // Function to create marker icon based on session status
        function getMarkerIcon(status) {
            const color = status === 'upcoming' ? '#48bb78' : '#718096';
            return L.divIcon({
                className: 'custom-marker',
                html: `<div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50%; border: 3px solid #333;"></div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });
        }

        // Function to create popup content
        function createPopupContent(session) {
            let topicsHtml = '';
            if (session.topics && session.topics.length > 0) {
                topicsHtml = `
                    <div class="session-topics">
                        <strong>Topics:</strong>
                        <ul>
                            ${session.topics.map(topic => `<li>${topic}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            const dateStr = new Date(session.date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Truncate description if too long
            const maxDescLength = 400;
            let description = session.description;
            if (description.length > maxDescLength) {
                description = description.substring(0, maxDescLength) + '...';
            }

            return `
                <div class="session-popup">
                    <h3>${session.title}</h3>
                    <span class="session-type">${session.type}</span>
                    <p class="session-date"><strong>Date:</strong> ${dateStr}</p>
                    <p class="session-location"><strong>Location:</strong> ${session.location}</p>
                    <p class="session-description">${description}</p>
                    ${topicsHtml}
                </div>
            `;
        }

        // Function to add sessions to map
        function addSessionsToMap(sessions) {
            sessions.forEach(session => {
                const marker = L.marker([session.lat, session.lng], {
                    icon: getMarkerIcon(session.status)
                });

                marker.bindPopup(createPopupContent(session), {
                    maxWidth: 400,
                    maxHeight: 400
                });

                // Store marker with session data for filtering
                marker.sessionData = session;
                allMarkers.push(marker);
                markerCluster.addLayer(marker);
            });
        }

        // Load and display sessions
        try {
            if (sessionsData.upcoming && Array.isArray(sessionsData.upcoming)) {
                addSessionsToMap(sessionsData.upcoming);
            }
            if (sessionsData.past && Array.isArray(sessionsData.past)) {
                addSessionsToMap(sessionsData.past);
            }

            // Fit map to show all markers
            if (allMarkers.length > 0) {
                const group = L.featureGroup(allMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        } catch (error) {
            console.error('Error loading sessions:', error);
        }

        // Filter functionality
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Update active button
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;

                // Clear current markers
                markerCluster.clearLayers();

                // Filter and add markers
                allMarkers.forEach(marker => {
                    const session = marker.sessionData;
                    let show = true;

                    if (filter === 'upcoming') {
                        show = session.status === 'upcoming';
                    } else if (filter === 'past') {
                        show = session.status === 'past';
                    } else if (filter !== 'all') {
                        // Type filter
                        show = session.type === filter;
                    }

                    if (show) {
                        markerCluster.addLayer(marker);
                    }
                });

                // Fit map to visible markers
                if (markerCluster.getLayers().length > 0) {
                    const group = L.featureGroup(markerCluster.getLayers());
                    map.fitBounds(group.getBounds().pad(0.1));
                }
            });
        });
    </script>
</body>
</html>
